# OCR精度改善 サンプル画像分析結果

## 提供されたサンプル画像一覧

### 1. OCRサンプル1（孫尚香1張紘1于吉1呂布1SP龐徳1許褚4程昱1荀攸1典韋1）.PNG
**正解データ**: 孫尚香1枚、張紘1枚、于吉1枚、呂布1枚、SP龐徳1枚、許褚4枚、程昱1枚、荀攸1枚、典韋1枚
**カード配置**: 3x3グリッド
**特徴**: 基本的な武将名とSP武将の混在

### 2. OCRサンプル2（諸葛亮1関銀屏2趙雲2曹操1SP関羽1SP董卓4太史慈3夏侯淵5鄧艾1）.PNG
**正解データ**: 諸葛亮1枚、関銀屏2枚、趙雲2枚、曹操1枚、SP関羽1枚、SP董卓4枚、太史慈3枚、夏侯淵5枚、鄧艾1枚
**カード配置**: 3x6グリッド（横長）
**特徴**: 複数枚所持武将とSP武将の混在

### 3. OCRサンプル3（程普6孫策1SP張梁1李儒1）.PNG
**正解データ**: 程普6枚、孫策1枚、SP張梁1枚、李儒1枚
**カード配置**: 2x5グリッド（縦長）
**特徴**: 高凸数武将（程普6枚）とSP武将

### 4. OCRサンプル4（程昱1夏侯惇1SP諸葛亮1関興1関銀屏1馬雲騄1馬忠1凌統1太史慈1）.PNG
**正解データ**: 程昱1枚、夏侯惇1枚、SP諸葛亮1枚、関興1枚、関銀屏1枚、馬雲騄1枚、馬忠1枚、凌統1枚、太史慈1枚
**カード配置**: 3x3グリッド
**特徴**: SP諸葛亮（通常の諸葛亮とは別）

### 5. OCRサンプル5（陸遜2于吉2SP曹真1許褚1郝昭1曹仁1程昱6）.PNG
**正解データ**: 陸遜2枚、于吉2枚、SP曹真1枚、許褚1枚、郝昭1枚、曹仁1枚、程昱6枚
**カード配置**: 3x3グリッド
**特徴**: 複数枚所持と高凸数武将

### 6. OCRサンプル6（陸遜5陸抗4周瑜2甘寧5満寵1法正1張春華2SP郭嘉1許褚1関銀屏1太史慈1麹義1）.PNG
**正解データ**: 陸遜5枚、陸抗4枚、周瑜2枚、甘寧5枚、満寵1枚、法正1枚、張春華2枚、SP郭嘉1枚、許褚1枚、関銀屏1枚、太史慈1枚、麹義1枚
**カード配置**: 4x3グリッド（横長）
**特徴**: 多数の武将と高凸数武将

### 7. OCRサンプル7（劉備1諸葛亮1SP袁紹1于吉2呂布1SP龐徳1許褚3程昱1）.PNG
**正解データ**: 劉備1枚、諸葛亮1枚、SP袁紹1枚、于吉2枚、呂布1枚、SP龐徳1枚、許褚3枚、程昱1枚
**カード配置**: 3x3グリッド
**特徴**: SP武将の混在

### 8. OCRサンプル8（許攸2沮授1呂玲綺1祝融1兀突骨3袁紹1張角2CO甄姫4王双1于禁1楽進2夏侯淵1郭嘉1）.PNG
**正解データ**: 許攸2枚、沮授1枚、呂玲綺1枚、祝融1枚、兀突骨3枚、袁紹1枚、張角2枚、CO甄姫4枚、王双1枚、于禁1枚、楽進2枚、夏侯淵1枚、郭嘉1枚
**カード配置**: 4x3グリッド（横長）
**特徴**: CO武将（CO甄姫）の初登場

### 9. OCRサンプル9（鄧艾1龐徳1王平2CO小喬3SP張梁2高覧1李儒1高順4馬騰1文醜4顔良1）.PNG
**正解データ**: 鄧艾1枚、龐徳1枚、王平2枚、CO小喬3枚、SP張梁2枚、高覧1枚、李儒1枚、高順4枚、馬騰1枚、文醜4枚、顔良1枚
**カード配置**: 4x3グリッド（横長）
**特徴**: CO武将とSP武将の混在

### 10. OCRサンプル10（CO関平1伊籍2厳顔3張苞2関興1関銀屏1馬雲騄1陳到1姜維1黄忠2趙雲1甘寧2呂蒙1）.PNG
**正解データ**: CO関平1枚、伊籍2枚、厳顔3枚、張苞2枚、関興1枚、関銀屏1枚、馬雲騄1枚、陳到1枚、姜維1枚、黄忠2枚、趙雲1枚、甘寧2枚、呂蒙1枚
**カード配置**: 4x3グリッド（横長）
**特徴**: CO武将（CO関平）と複数枚所持武将

### 11. OCRサンプル11（凌統1賈詡2王異1典韋1呂蒙1公孫瓚1黄月英4孫尚香2董卓1魏延1魯粛3郭嘉3）.PNG
**正解データ**: 凌統1枚、賈詡2枚、王異1枚、典韋1枚、呂蒙1枚、公孫瓚1枚、黄月英4枚、孫尚香2枚、董卓1枚、魏延1枚、魯粛3枚、郭嘉3枚
**カード配置**: 4x3グリッド（横長）
**特徴**: 複数枚所持武将の多い構成

### 12. OCRサンプル12（関羽2陸遜2CO呂玲綺1SP袁紹1呂布1SP曹真1許褚1張郃2郝昭1曹仁2程昱1夏侯惇3）.PNG
**正解データ**: 関羽2枚、陸遜2枚、CO呂玲綺1枚、SP袁紹1枚、呂布1枚、SP曹真1枚、許褚1枚、張郃2枚、郝昭1枚、曹仁2枚、程昱1枚、夏侯惇3枚
**カード配置**: 4x3グリッド（横長）
**特徴**: CO武将、SP武将、通常武将の混在

### 13. OCRサンプル13（劉備3SP孫堅2CO星彩3張飛3孫権5周泰2太史慈2夏侯淵5SP荀彧1SP馬超2程普6鍾会3）.PNG
**正解データ**: 劉備3枚、SP孫堅2枚、CO星彩3枚、張飛3枚、孫権5枚、周泰2枚、太史慈2枚、夏侯淵5枚、SP荀彧1枚、SP馬超2枚、程普6枚、鍾会3枚
**カード配置**: 4x3グリッド（横長）
**特徴**: 全種類の武将（通常、SP、CO）が混在

## カード配置パターン分析

### 1. 3x3グリッド（正方形）
- サンプル1, 3, 4, 5, 7
- カードサイズ: 約400x300px
- 特徴: 標準的な配置

### 2. 3x6グリッド（横長）
- サンプル2
- カードサイズ: 約400x300px
- 特徴: 縦スクロール対応

### 3. 2x5グリッド（縦長）
- サンプル3
- カードサイズ: 約600x360px
- 特徴: 横スクロール対応

### 4. 4x3グリッド（横長）
- サンプル6, 8, 9, 10, 11, 12, 13
- カードサイズ: 約300x400px
- 特徴: 多数の武将表示

## 武将分類分析

### 1. プレフィックス無し武将（通常武将）
**総数**: 約50武将
**例**: 孫尚香、張紘、于吉、呂布、許褚、程昱、荀攸、典韋、諸葛亮、関銀屏、趙雲、曹操、太史慈、夏侯淵、鄧艾、程普、孫策、李儒、夏侯惇、関興、馬雲騄、馬忠、凌統、陸遜、郝昭、曹仁、陸抗、周瑜、甘寧、満寵、法正、張春華、麹義、劉備、許攸、沮授、呂玲綺、祝融、兀突骨、袁紹、張角、王双、于禁、楽進、郭嘉、鄧艾、龐徳、王平、高覧、李儒、高順、馬騰、文醜、顔良、伊籍、厳顔、張苞、関興、関銀屏、馬雲騄、陳到、姜維、黄忠、趙雲、甘寧、呂蒙、凌統、賈詡、王異、典韋、呂蒙、公孫瓚、黄月英、孫尚香、董卓、魏延、魯粛、郭嘉、関羽、陸遜、呂布、許褚、張郃、郝昭、曹仁、程昱、夏侯惇、劉備、張飛、孫権、周泰、太史慈、夏侯淵、程普、鍾会

### 2. SP武将
**総数**: 約15武将
**例**: SP龐徳、SP関羽、SP董卓、SP張梁、SP諸葛亮、SP曹真、SP郭嘉、SP袁紹、SP龐徳、SP張梁、SP曹真、SP袁紹、SP荀彧、SP馬超、SP孫堅

**特徴**:
- 武将名の左上に「SP」ラベルが表示
- 赤色で表示されることが多い
- 通常の同名武将とは別扱い

### 3. CO武将
**総数**: 約7武将
**例**: CO甄姫、CO小喬、CO関平、CO呂玲綺、CO星彩

**特徴**:
- 武将名の左上に「無双」ラベルが表示
- 金色や黄色で表示されることが多い
- SPラベルより少し上の位置

## 凸数パターン分析

### 1. 凸数0（1枚所持）
**武将数**: 約40武将
**例**: 孫尚香、張紘、于吉、呂布、諸葛亮、関銀屏、趙雲、曹操、太史慈、鄧艾、程普、孫策、李儒、夏侯惇、関興、馬雲騄、馬忠、凌統、郝昭、曹仁、陸抗、周瑜、甘寧、満寵、法正、張春華、麹義、劉備、許攸、沮授、呂玲綺、祝融、兀突骨、袁紹、張角、王双、于禁、楽進、郭嘉、鄧艾、龐徳、王平、高覧、李儒、高順、馬騰、文醜、顔良、伊籍、厳顔、張苞、関興、関銀屏、馬雲騄、陳到、姜維、黄忠、趙雲、甘寧、呂蒙、凌統、賈詡、王異、典韋、呂蒙、公孫瓚、黄月英、孫尚香、董卓、魏延、魯粛、郭嘉、関羽、陸遜、呂布、許褚、張郃、郝昭、曹仁、程昱、夏侯惇、劉備、張飛、孫権、周泰、太史慈、夏侯淵、程普、鍾会

### 2. 凸数1（2枚所持）
**武将数**: 約15武将
**例**: 関銀屏、趙雲、于吉、陸遜、王平、張苞、関興、黄忠、趙雲、甘寧、呂蒙、賈詡、孫尚香、魯粛、郭嘉、関羽、陸遜、張郃、曹仁、程昱、劉備、SP孫堅、張飛、周泰、太史慈、夏侯淵、SP馬超、鍾会

### 3. 凸数2（3枚所持）
**武将数**: 約8武将
**例**: 太史慈、楽進、夏侯淵、高順、文醜、伊籍、厳顔、呂蒙、魯粛、郭嘉、夏侯惇、SP孫堅、CO星彩、張飛、周泰、太史慈、夏侯淵、SP馬超、鍾会

### 4. 凸数3（4枚所持）
**武将数**: 約5武将
**例**: 許褚、兀突骨、CO甄姫、高順、文醜、黄月英、孫尚香、魯粛、郭嘉、夏侯惇、SP孫堅、CO星彩、張飛、周泰、太史慈、夏侯淵、SP馬超、鍾会

### 5. 凸数4（5枚所持）
**武将数**: 約3武将
**例**: 夏侯淵、陸遜、甘寧、黄月英、孫尚香、魯粛、郭嘉、夏侯惇、SP孫堅、CO星彩、張飛、周泰、太史慈、夏侯淵、SP馬超、鍾会

### 6. 凸数5（6枚所持）
**武将数**: 約2武将
**例**: 程昱、程普

## 画像品質分析

### 1. 解像度
- **平均解像度**: 1200x1800px
- **最小解像度**: 800x1200px
- **最大解像度**: 1600x2400px

### 2. 画質
- **文字の鮮明度**: 良好
- **コントラスト**: 適度
- **ノイズ**: 最小限

### 3. 照明条件
- **明度**: 適切
- **影**: 最小限
- **反射**: なし

## 検出難易度分析

### 1. 容易な検出
- **通常武将**: プレフィックスなし、短い名前
- **高コントラスト**: 背景との色差が大きい
- **中央配置**: カードの中央に配置

### 2. 中程度の検出
- **SP武将**: 赤色ラベルの検出が必要
- **複数枚所持**: 凸数の正確なカウントが必要
- **長い名前**: 文字数が多い武将名

### 3. 困難な検出
- **CO武将**: 金色ラベルの検出が困難
- **見切れカード**: 境界付近のカード
- **低コントラスト**: 背景との色差が小さい

## 改善前の問題点

### 1. 文字化け
- **例**: 「し 当 人 当 消」「Po 目 会」「し ど 』 々 と ーー に」
- **原因**: 日本語文字認識の失敗
- **対策**: 文字ホワイトリストの導入

### 2. 低信頼度
- **信頼度**: 14-23%
- **原因**: 画像前処理の不適切さ
- **対策**: コントラスト調整と二値化の最適化

### 3. 誤検出
- **例**: 全武将が「王異」として検出
- **原因**: ROI抽出の不正確さ
- **対策**: 精密なROI抽出の実装

### 4. プレフィックス未対応
- **問題**: SP/CO武将の識別失敗
- **原因**: マスタデータの構造不足
- **対策**: プレフィックス対応のマスタデータと照合ロジック

## 改善後の期待効果

### 1. 精度向上
- **文字化け解消**: 文字ホワイトリストによる正確な文字認識
- **信頼度向上**: 最適化された画像前処理
- **誤検出削減**: 精密なROI抽出と見切れカード除外

### 2. 機能拡張
- **SP武将対応**: 赤色ラベル検出による正確な識別
- **CO武将対応**: 金色ラベル検出による正確な識別
- **プレフィックス対応**: 3種類の武将分類

### 3. 処理効率
- **見切れカード除外**: 不要な処理の削減
- **動的グリッド検出**: 画像サイズに応じた最適化
- **並列処理**: カード単位での効率的な処理

## テスト計画

### 1. 単体テスト
- 各関数の個別テスト
- エッジケースの検証
- パフォーマンステスト

### 2. 統合テスト
- サンプル画像での検証
- 正解データとの比較
- 精度測定

### 3. 負荷テスト
- 大量画像の処理
- メモリ使用量の監視
- 処理時間の測定

## 今後の改善案

### 1. 機械学習統合
- CNNベースのカード検出
- 文字認識の精度向上
- 自動学習システム

### 2. リアルタイム処理
- WebRTC統合
- ストリーミング処理
- 低遅延最適化

### 3. 多言語対応
- 英語OCR対応
- 中国語OCR対応
- 動的言語切り替え
